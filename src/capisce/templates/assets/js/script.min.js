async function showResponseContent(e,t){if(t.hasOwnProperty("error")){let e=`Error: ${t.error}`;return void $("#response-content").html(e)}let n=t.body,r=t.status_code,s=t.content_type,o=t.headers,a=t.content_type.match(mime_regex);if(!a)return void console.log("Content-Type unknown.");let i=a[0];if($("#progressBar").addClass("visually-hidden"),"HEAD"===e){let e=`<strong class="text-danger">Status:</strong> ${r}<br><br><strong class="text-danger">Content Type:</strong> ${s}<br><br><strong class="text-danger">Headers:</strong> ${js_beautify(JSON.stringify(o))}`;$("#response-content").html(e)}else{if("application/octet-stream"==i){let e=`Status: ${r}<br><br>Content Type: ${s}<br><br>Headers: ${js_beautify(JSON.stringify(o))}<br><br>Can't show the contents of the body here, you have to donwload it.`;return void $("#response-content").html(e)}if("application/json"==i){let e=`Status: ${r}\n\nContent Type: ${s}\n\nHeaders: ${js_beautify(JSON.stringify(o))}\n\nBody:\n${js_beautify(atob(n))}`;return void $("#response-content").text(e)}if("text/html"==i){let e=`Status: ${r}\n\nContent Type: ${s}\n\nHeaders: ${js_beautify(JSON.stringify(o))}\n\nBody:\n${html_beautify(atob(n))}`;return void $("#response-content").text(e)}if("text/css"==i){let e=`Status: ${r}\n\nContent Type: ${s}\n\nHeaders: ${js_beautify(JSON.stringify(o))}\n\nBody:\n${css_beautify(atob(n))}`;return void $("#response-content").text(e)}if("application/xml"==i){let e=`Status: ${r}\n\nContent Type: ${s}\n\nHeaders: ${js_beautify(JSON.stringify(o))}\n\nBody:\n${html_beautify(atob(n))}`;return void $("#response-content").text(e)}if(i.startsWith("image/")){let e=`Status: ${r}<br><br>Content Type: ${s}<br><br>Headers: ${js_beautify(JSON.stringify(o))}<br><br>Image:<br><img class="img-fluid" src="data:${i};base64,${n}"></img>`;return void $("#response-content").html(e)}if(i.startsWith("video/")){let e=`Status: ${r}<br><br>Content Type: ${s}<br><br>Headers: ${js_beautify(JSON.stringify(o))}<br><br>Video:<br><video src="data:${i};base64,${n}" controls></video>`;return void $("#response-content").html(e)}if(i.startsWith("audio/")){let e=`Status: ${r}<br><br>Content Type: ${s}<br><br>Headers: ${js_beautify(JSON.stringify(o))}<br><br>Audio:<br><audio src="data:${i};base64,${n}" controls></audio>`;return void $("#response-content").html(e)}if(i.startsWith("text/")){let e=`Status: ${r}\n\nContent Type: ${s}\n\nHeaders: ${js_beautify(JSON.stringify(o))}\n\nBody:\n${atob(n)}`;return void $("#response-content").text(e)}let e=`Status: ${r}<br><br>Content Type: ${s}<br><br>Headers: ${js_beautify(JSON.stringify(o))}<br><br>Can't show the contents of the body here, you have to donwload it.`;$("#response-content").html(e)}}async function download_content(e){let t,n=$(e).attr("r_index"),r=JSON.parse(sessionStorage.getItem("response-"+n)),s=$("#download-link");if(r.hasOwnProperty("error")){t=r;let e="data:text/json;charset=utf-8,"+encodeURIComponent(t);return s.attr("download","response.json"),s.attr("href",e),void document.getElementById("download-link").click()}t=r.body;let o=r.content_type.match(mime_regex);if(!o)return void console.log("Content-Type unknown.");let a=o[0];if(!mime_db.hasOwnProperty(a))return void console.log("MIME type not in the database.");let i=mime_db[a];if(!i.hasOwnProperty("extensions"))return void console.log("MIME type has no extensions.");let d="."+i.extensions[0],l=`data:${i};base64,${t}`;s.attr("download","response"+d),s.attr("href",l),document.getElementById("download-link").click()}const req_server="http://localhost:5000",mime_regex=/(\S+\/[^;]+)/,setup_row=$(".table-unrow").first().clone();var r_index=0,mime_db=null;async function sendRequest(){var e=$("#method-button").text(),t=$("#endpoint").val();if(!t)return void $("#endpoint").focus();$("#progressBar").removeClass("visually-hidden");var n={},r={},s={},o=$("#params-table").find(".table-row");for(row of o)n[$(row).find(".table-key").val()]=$(row).find(".table-value").val();var a=$("#headers-table").find(".table-row");for(row of a)r[$(row).find(".table-key").val()]=$(row).find(".table-value").val();var i=$("#body-table").find(".table-row");for(row of i)s[$(row).find(".table-key").val()]=$(row).find(".table-value").val();let d=[t,n,r,s];if(sessionStorage.setItem("request-"+r_index,JSON.stringify(d)),showRequestContent(e,d),"GET"==e){var l=await makeGetRequest(t,n,r);sessionStorage.setItem("response-"+r_index,JSON.stringify(l)),showResponseContent(e,l),$("#download-response-button").attr("r_index",r_index);let s=$("#requests-examples").find(".get-request").clone();return s.attr("method",e),s.attr("r_index",r_index),s.find(".request-title").text(t),$("#requests-history").prepend(s),$("#currentRequest").empty().append(s.clone()),void(r_index+=1)}if("HEAD"==e){l=await makeHeadRequest(t,n,r);sessionStorage.setItem("response-"+r_index,JSON.stringify(l)),showResponseContent(e,l),$("#download-response-button").attr("r_index",r_index);let s=$("#requests-examples").find(".head-request").clone();return s.attr("method",e),s.attr("r_index",r_index),s.find(".request-title").text(t),$("#requests-history").prepend(s),$("#currentRequest").empty().append(s.clone()),void(r_index+=1)}if("POST"==e){l=await makePostRequest(t,n,r,s);sessionStorage.setItem("response-"+r_index,JSON.stringify(l)),showResponseContent(e,l),$("#download-response-button").attr("r_index",r_index);let o=$("#requests-examples").find(".post-request").clone();return o.attr("method",e),o.attr("r_index",r_index),o.find(".request-title").text(t),$("#requests-history").prepend(o),$("#currentRequest").empty().append(o.clone()),void(r_index+=1)}if("PUT"==e){l=await makePutRequest(t,n,r,s);sessionStorage.setItem("response-"+r_index,JSON.stringify(l)),showResponseContent(e,l),$("#download-response-button").attr("r_index",r_index);let o=$("#requests-examples").find(".put-request").clone();return o.attr("method",e),o.attr("r_index",r_index),o.find(".request-title").text(t),$("#requests-history").prepend(o),$("#currentRequest").empty().append(o.clone()),void(r_index+=1)}if("DELETE"==e){l=await makeDeleteRequest(t,n,r,s);sessionStorage.setItem("response-"+r_index,JSON.stringify(l)),showResponseContent(e,l),$("#download-response-button").attr("r_index",r_index);let o=$("#requests-examples").find(".delete-request").clone();return o.attr("method",e),o.attr("r_index",r_index),o.find(".request-title").text(t),$("#requests-history").prepend(o),$("#currentRequest").empty().append(o.clone()),void(r_index+=1)}if("OPTIONS"==e){l=await makeOptionsRequest(t,n,r);sessionStorage.setItem("response-"+r_index,JSON.stringify(l)),showResponseContent(e,l),$("#download-response-button").attr("r_index",r_index);let s=$("#requests-examples").find(".options-request").clone();return s.attr("method",e),s.attr("r_index",r_index),s.find(".request-title").text(t),$("#requests-history").prepend(s),$("#currentRequest").empty().append(s.clone()),void(r_index+=1)}if("PATCH"==e){l=await makePatchRequest(t,n,r,s);sessionStorage.setItem("response-"+r_index,JSON.stringify(l)),showResponseContent(e,l),$("#download-response-button").attr("r_index",r_index);let o=$("#requests-examples").find(".patch-request").clone();return o.attr("method",e),o.attr("r_index",r_index),o.find(".request-title").text(t),$("#requests-history").prepend(o),$("#currentRequest").empty().append(o.clone()),void(r_index+=1)}}async function loadHistoricRequest(e){let t=$(e).attr("method"),n=$(e).attr("r_index"),r=JSON.parse(sessionStorage.getItem("request-"+n)),s=JSON.parse(sessionStorage.getItem("response-"+n));$("#currentRequest").empty(),$("#currentRequest").append($(e).clone()),showRequestContent(t,r),showResponseContent(t,s)}function check_row(e){return $(e).hasClass("btn-primary")?($(e).removeClass("btn-primary").addClass("btn-danger"),void $(e).closest(".table-row").removeClass("table-row").addClass("table-unrow")):$(e).hasClass("btn-danger")?($(e).removeClass("btn-danger").addClass("btn-primary"),void $(e).closest(".table-unrow").removeClass("table-unrow").addClass("table-row")):void 0}function delete_row(e){$(e).closest(".table-row").remove()}function setup(e){var t=$(e).closest(".table-unrow");t.removeClass("table-unrow").addClass("table-row");let n=$("#helper-elements").find(".checkbox-item").clone(),r=$("#helper-elements").find(".delete-item").clone();$(e).closest("tbody").append(setup_row.clone()),t.find(".table-key").parent().prepend(n),t.find(".table-value").parent().append(r),t.find(".table-key").prop("onkeypress",null),t.find(".table-value").prop("onkeypress",null)}function loadMimeDB(){return $.getJSON("assets/json/db.json").then((e=>e))}function downloadMimeDB(){return $.getJSON("https://cdn.jsdelivr.net/npm/mime-db@1/db.json").then((e=>e))}function construct_url(e,t){if(Object.keys(t).length){let n=new URL(e),r=new URLSearchParams(n.search);for(key of Object.keys(t))r.append(key,t[key]);e=new URL(`${n.origin}${n.pathname}?${r}`).href}return e}function makeGetRequest(e,t,n){return e=construct_url(e,t),fetch(req_server+"/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e,headers:n})}).then((e=>e.json()))}function makeHeadRequest(e,t,n){return e=construct_url(e,t),fetch(req_server+"/head",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e,headers:n})}).then((e=>e.json()))}function makePostRequest(e,t,n,r){return e=construct_url(e,t),fetch(req_server+"/post",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e,headers:n,body:r})}).then((e=>e.json()))}function makePutRequest(e,t,n,r){return e=construct_url(e,t),fetch(req_server+"/put",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e,headers:n,body:r})}).then((e=>e.json()))}function makeDeleteRequest(e,t,n,r){return e=construct_url(e,t),fetch(req_server+"/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e,headers:n,body:r})}).then((e=>e.json()))}function makeOptionsRequest(e,t,n){return e=construct_url(e,t),fetch(req_server+"/options",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e,headers:n})}).then((e=>e.json()))}function makePatchRequest(e,t,n,r){return e=construct_url(e,t),fetch(req_server+"/patch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e,headers:n,body:r})}).then((e=>e.json()))}async function showRequestContent(e,t){var n=construct_url(t[0],t[1]),r="";for(key of Object.keys(t[2]))r+=`&nbsp;&nbsp;&nbsp;&nbsp;${key}&nbsp;:&nbsp;${t[2][key]}<br>`;var s="";for(key of Object.keys(t[3]))s+=`&nbsp;&nbsp;&nbsp;&nbsp;${key}&nbsp;:&nbsp;${t[2][key]}<br>`;switch(e){case"GET":var o=`URL: ${n}<br>HEADERS:<br>${r}`;break;case"HEAD":o=`URL: ${n}<br>HEADERS:<br>${r}`;break;case"POST":o=`URL: ${n}<br>HEADERS:<br>${r}BODY:<br>${s}`;break;case"PUT":o=`URL: ${n}<br>HEADERS:<br>${r}BODY:<br>${s}`;break;case"DELETE":o=`URL: ${n}<br>HEADERS:<br>${r}BODY:<br>${s}`;break;case"OPTIONS":o=`URL: ${n}<br>HEADERS:<br>${r}`;break;case"PATCH":o=`URL: ${n}<br>HEADERS:<br>${r}BODY:<br>${s}`}$("#request-content").html(o)}$(window).on("load",(async function(){sessionStorage.clear();try{mime_db=await loadMimeDB()}catch(e){mime_db=await downloadMimeDB()}console.assert(null!=mime_db,"mime-db not loaded correctly.")})),$(".method").on("click",(function(){$("#method-button").text(this.text)})),$("#endpoint").on("keyup",(function(e){"Enter"==e.key&&sendRequest()})),$("#send-button").on("click",sendRequest);